<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©é©¬å›­åŒº | ç»¼åˆäººåŠ›æ’ç­å†³ç­–æ¨¡å‹</title
    <meta name="robots" content="noindex, nofollow">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --bg-color: #FDFCFB;
            --text-main: #2C3E50;
            --text-sub: #7F8C8D;
            --border-color: #E0E0E0;
            
            /* è«å…°è¿ªé…è‰² */
            --roche-blue: #77929F;
            --roche-sand: #D4C4B7;
            --device-green: #9CAF88;
            --medicine-purple: #95A5A6; 
        }

        body {
            font-family: "Microsoft YaHei", "Heiti SC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            gap: 20px;
            height: 100vh;
            overflow: hidden;
            box-sizing: border-box;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 340px;
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            height: 100%;
            overflow-y: auto;
            flex-shrink: 0;
            scrollbar-width: thin;
        }
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 3px; }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
            overflow-y: auto;
            padding-right: 5px;
        }

        h1 { font-size: 24px; color: #5C6E7D; margin: 0 0 5px 0; }
        h3 { font-size: 15px; margin: 15px 0 10px 0; color: var(--text-main); font-weight: bold; }
        h4 { font-size: 15px; margin: 0 0 10px 0; font-weight: bold; }

        label { display: block; margin-top: 10px; font-size: 13px; color: #555; font-weight: 500; }
        
        input[type="range"] { width: 100%; cursor: pointer; }
        input[type="number"], select {
            width: 100%;
            padding: 6px 8px;
            margin-top: 4px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 13px;
        }
        
        .input-readonly { background-color: #f0f0f0; color: #333; font-weight: bold; border: 1px solid #ddd; cursor: not-allowed; }

        .staff-calc-group { background-color: #f9f9f9; padding: 12px; border-radius: 6px; border: 1px solid #eee; margin-bottom: 15px; }
        .staff-calc-group h5 { margin: 0 0 8px 0; font-size: 13px; color: #333; border-bottom: 1px dashed #ccc; padding-bottom: 5px; }
        .calc-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .calc-row label { margin: 0; font-size: 12px; color: #666; }
        .calc-row input { width: 70px; text-align: right; }
        .calc-result-row { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; padding-top: 8px; border-top: 1px solid #e0e0e0; }
        .calc-result-row label { font-weight: bold; color: #333; }
        .calc-result-row input { color: #2980b9; width: 70px; text-align: right; font-weight: bold; }

        #project-select { padding: 10px; font-size: 16px; color: white; background-color: var(--roche-blue); border: none; border-radius: 6px; margin-bottom: 20px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #project-select option { background-color: white; color: #333; }

        .columns { display: flex; gap: 20px; flex-wrap: wrap; }
        .col { flex: 1; min-width: 320px; }

        .card { background: white; padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 20px; transition: box-shadow 0.2s; }
        .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        .view-roche .card-header-cold { border-left: 5px solid var(--roche-blue); padding-left: 10px; margin-bottom: 15px; }
        .view-roche .card-header-amb { border-left: 5px solid var(--roche-sand); padding-left: 10px; margin-bottom: 15px; }
        .view-device .card-header { border-left: 5px solid var(--device-green); padding-left: 10px; margin-bottom: 15px; }
        .view-medicine .card-header { border-left: 5px solid var(--medicine-purple); padding-left: 10px; margin-bottom: 15px; }

        .dashboard { display: flex; gap: 15px; width: 100%; flex-wrap: nowrap; align-items: stretch; flex-shrink: 0; }
        #dash-roche-group { display: flex; gap: 15px; flex: 2; }
        #dash-device-group, #dash-medicine-group { flex: 2; display: flex; }
        .dash-card { flex: 1; padding: 15px 5px; background: white; border-radius: 8px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.05); min-width: 0; }
        .dash-total { flex: 1; border-top: 5px solid #C6A4A4; background: #FFF9F9; }

        .metric-val { font-size: 28px; font-weight: bold; margin: 5px 0; white-space: nowrap; }
        .metric-sub { font-size: 12px; color: var(--text-sub); }

        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        /* åº•éƒ¨å›¾è¡¨ (ä¿®å¤æ˜¾ç¤ºä¸å…¨çš„æ ¸å¿ƒä»£ç ) */
        .chart-container { background: white; padding: 25px; border-radius: 8px; margin-top: 20px; border: 1px solid var(--border-color); }
        .chart-row { display: flex; align-items: center; margin-bottom: 10px; font-size: 13px; }
        
        /* æ ‡ç­¾å®½åº¦ */
        .chart-label { width: 200px; text-align: right; padding-right: 15px; color: #555; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 0; }
        
        /* è¿›åº¦æ¡åŒºåŸŸ */
        .chart-bar-area { flex: 1; background: #f0f0f0; height: 24px; border-radius: 4px; overflow: hidden; }
        .chart-bar { height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 10px; color: white; font-size: 12px; white-space: nowrap;}
        
        /* æ•°å€¼æ˜¾ç¤ºåŒºåŸŸ (ä¿®å¤é‡ç‚¹ï¼šåŠ å®½ã€é˜²æ­¢å‹ç¼©) */
        .chart-val { 
            width: 120px;         /* åŠ å®½åˆ°120px */
            padding-left: 10px; 
            font-weight: bold; 
            color: #333; 
            flex-shrink: 0;       /* ç»ä¸è®¸è¢«å‹ç¼© */
            text-align: left;     /* é å·¦å¯¹é½ */
        }

        .hidden { display: none !important; }
        
        .btn { background-color: #5C6E7D; color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 20px; margin-bottom: 30px; font-weight: bold; font-size: 14px; transition: all 0.2s; }
        .btn:hover { background-color: #4a5a6a; transform: translateY(-1px); }
        .btn-link { background-color: #95a5a6; margin-top: 10px; font-size: 12px; padding: 8px; }

        /* PDF éšè—åŸŸ */
        #pdf-container {
            position: fixed;
            left: -9999px;
            top: 0;
            width: 900px; 
            background: white;
            padding: 40px;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
            color: #333;
        }
        
        .pdf-header { border-bottom: 4px solid #5C6E7D; padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-end; }
        .pdf-title { font-size: 26px; font-weight: bold; color: #2C3E50; }
        .pdf-date { font-size: 14px; color: #7F8C8D; }
        .pdf-decision-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .pdf-kpi-card { flex: 1; padding: 15px; border-radius: 6px; text-align: center; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .pdf-kpi-title { font-size: 14px; opacity: 0.9; margin-bottom: 5px; }
        .pdf-kpi-val { font-size: 32px; font-weight: bold; }
        .pdf-kpi-sub { font-size: 12px; opacity: 0.8; margin-top: 5px; }
        .pdf-resource-bar { background: #f4f6f7; border: 1px solid #ddd; border-radius: 6px; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; font-size: 13px; }
        .pdf-res-item strong { color: #2C3E50; }
        .pdf-details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px; align-items: start; }
        .pdf-col-title { font-size: 16px; font-weight: bold; color: #5C6E7D; border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 10px; }
        .pdf-task-group { margin-bottom: 12px; break-inside: avoid; }
        .pdf-group-name { font-size: 13px; font-weight: bold; color: #2C3E50; margin-bottom: 4px; background:#eef; padding:2px 5px; display:inline-block; border-radius:3px; }
        .pdf-task-item { display: flex; justify-content: space-between; font-size: 12px; color: #555; border-bottom: 1px dashed #eee; padding: 3px 0; }
        .pdf-task-name { font-weight: 500; }
        .pdf-chart-section { margin-top: 20px; border-top: 2px solid #eee; padding-top: 15px; }
        .pdf-chart-title { font-size: 14px; font-weight: bold; color: #7F8C8D; margin-bottom: 10px; }

        @media print {
            body { height: auto; overflow: visible; display: block; }
            .sidebar, .btn { display: none; }
            .chart-container { break-inside: avoid; }
            .main-content { height: auto; overflow: visible; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <label style="margin-top:0">ğŸ“Š é€‰æ‹©é¡¹ç›®ç»„</label>
        <select id="project-select" onchange="switchView()">
            <option value="roche">ğŸ’Š ç½—è¯Š (Roche)</option>
            <option value="device">âš™ï¸ å™¨æ¢° (Device)</option>
            <option value="medicine">ğŸŒ¿ è¯å“ (Medicine)</option>
        </select>

        <h2>âš™ï¸ å†³ç­–å‚æ•°</h2>
        <label>ä¸´æ—¶å·¥æ•ˆç‡ç³»æ•° <span id="disp_eff" style="float:right; font-weight:bold;">1.00</span></label>
        <input type="range" id="eff" min="0.1" max="1.0" step="0.05" value="1.0" oninput="update()">
        <label>OEE (æœ‰æ•ˆä½œä¸šç‡) <span id="disp_oee" style="float:right; font-weight:bold;">1.00</span></label>
        <input type="range" id="oee" min="0.1" max="1.0" step="0.05" value="1.0" oninput="update()">
        <label>ç­æ¬¡æ—¶é•¿</label>
        <select id="shift" onchange="update()">
            <option value="8">8 å°æ—¶/ç­</option>
            <option value="12">12 å°æ—¶/ç­</option>
        </select>

        <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee;">
            <h3>ğŸ‘¥ æ­£å¼å·¥å‡ºå‹¤è®¡ç®—</h3>
            <div id="formal-roche">
                <div class="staff-calc-group">
                    <h5>â„ï¸ ç½—è¯Šå†·é“¾ç»„</h5>
                    <div class="calc-row"><label>â• åœ¨å†Œäººæ•°</label><input type="number" id="base_roche_cold" class="staff-base" min="0" value="0" oninput="update()"></div>
                    <div class="calc-row"><label>â– è¯·å‡/æ´¾å»</label><input type="number" id="abs_roche_cold" class="staff-dynamic" min="0" value="0" oninput="update()"></div>
                    <div class="calc-row"><label>â• æ´¾æ¥æ”¯æ´</label><input type="number" id="sup_roche_cold" class="staff-dynamic" min="0" value="0" oninput="update()"></div>
                    <div class="calc-result-row"><label>ã€“ å®é™…å¯ç”¨</label><input type="number" id="fc_roche_cold" class="input-readonly" readonly value="0"></div>
                </div>
                <div class="staff-calc-group">
                    <h5>â˜€ï¸ ç½—è¯Šå¸¸æ¸©ç»„</h5>
                    <div class="calc-row"><label>â• åœ¨å†Œäººæ•°</label><input type="number" id="base_roche_amb" class="staff-base" min="0" value="0" oninput="update()"></div>
                    <div class="calc-row"><label>â– è¯·å‡/æ´¾å»</label><input type="number" id="abs_roche_amb" class="staff-dynamic" min="0" value="0" oninput="update()"></div>
                    <div class="calc-row"><label>â• æ´¾æ¥æ”¯æ´</label><input type="number" id="sup_roche_amb" class="staff-dynamic" min="0" value="0" oninput="update()"></div>
                    <div class="calc-result-row"><label>ã€“ å®é™…å¯ç”¨</label><input type="number" id="fc_roche_amb" class="input-readonly" readonly value="0"></div>
                </div>
            </div>
            
            <div id="formal-device" class="hidden">
                <div class="staff-calc-group">
                    <h5>âš™ï¸ å™¨æ¢°ç»„</h5>
                    <div class="calc-row"><label>â• åœ¨å†Œäººæ•°</label><input type="number" id="base_device" class="staff-base" min="0" value="0" oninput="update()"></div>
                    <div class="calc-row"><label>â– è¯·å‡/æ´¾å»</label><input type="number" id="abs_device" class="staff-dynamic" min="0" value="0" oninput="update()"></div>
                    <div class="calc-row"><label>â• æ´¾æ¥æ”¯æ´</label><input type="number" id="sup_device" class="staff-dynamic" min="0" value="0" oninput="update()"></div>
                    <div class="calc-result-row"><label>ã€“ å®é™…å¯ç”¨</label><input type="number" id="fc_device" class="input-readonly" readonly value="0"></div>
                </div>
            </div>

            <div id="formal-medicine" class="hidden">
                <div class="staff-calc-group">
                    <h5>ğŸŒ¿ è¯å“ç»„</h5>
                    <div class="calc-row"><label>â• åœ¨å†Œäººæ•°</label><input type="number" id="base_medicine" class="staff-base" min="0" value="0" oninput="update()"></div>
                    <div class="calc-row"><label>â– è¯·å‡/æ´¾å»</label><input type="number" id="abs_medicine" class="staff-dynamic" min="0" value="0" oninput="update()"></div>
                    <div class="calc-row"><label>â• æ´¾æ¥æ”¯æ´</label><input type="number" id="sup_medicine" class="staff-dynamic" min="0" value="0" oninput="update()"></div>
                    <div class="calc-result-row"><label>ã€“ å®é™…å¯ç”¨</label><input type="number" id="fc_medicine" class="input-readonly" readonly value="0"></div>
                </div>
            </div>
        </div>

        <div style="margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
            <button class="btn" onclick="generatePDF()" style="background-color: #e74c3c;">ğŸ“„ ç”Ÿæˆæ±‡æŠ¥ PDF</button>
            <div id="pdf-msg" style="font-size:12px; color:#c0392b; text-align:center; display:none;">ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...</div>
            <button class="btn btn-link" onclick="generateLink()">ğŸ”— ä»…ç”Ÿæˆé“¾æ¥</button>
            <div id="link-msg" style="font-size:12px; color:#27ae60; text-align:center; display:none;">é“¾æ¥å·²å¤åˆ¶</div>
        </div>
    </div>

    <div class="main-content">
        <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom: 2px solid #eee; padding-bottom: 10px;">
            <div>
                <h1 id="page-title">ç½—è¯Šé¡¹ç›®äººåŠ›æ’ç­å†³ç­–æ¨¡å‹</h1>
                <div style="color:var(--text-sub); font-size:14px;">Tianma Logistics Park Staffing Model</div>
            </div>
            <div style="text-align:right;">
                <h3 id="currentDate" style="color:#5C6E7D; margin:0;"></h3>
            </div>
        </div>

        <div class="dashboard">
            <div id="dash-roche-group">
                <div class="dash-card" style="border-top: 5px solid var(--roche-blue); background: #F4F7F9;">
                    <h4 style="color:#2C3E50">â„ï¸ å†·é“¾éœ€æ±‚</h4>
                    <div class="metric-val" id="res_roche_cold">0 äºº</div>
                    <div class="metric-sub">ç¼ºå£: <span id="gap_roche_cold">0.0</span> H</div>
                </div>
                <div class="dash-card" style="border-top: 5px solid var(--roche-sand); background: #F9F7F5; margin-left: 15px;">
                    <h4 style="color:#5D5046">â˜€ï¸ å¸¸æ¸©éœ€æ±‚</h4>
                    <div class="metric-val" id="res_roche_amb">0 äºº</div>
                    <div class="metric-sub">ç¼ºå£: <span id="gap_roche_amb">0.0</span> H</div>
                </div>
            </div>
            <div id="dash-device-group" class="hidden">
                <div class="dash-card" style="border-top: 5px solid var(--device-green); background: var(--device-bg); width: 100%;">
                    <h4 style="color:#556B2F">âš™ï¸ å™¨æ¢°ç»„éœ€æ±‚</h4>
                    <div class="metric-val" id="res_device">0 äºº</div>
                    <div class="metric-sub">ç¼ºå£: <span id="gap_device">0.0</span> H</div>
                </div>
            </div>
            <div id="dash-medicine-group" class="hidden">
                <div class="dash-card" style="border-top: 5px solid var(--medicine-purple); background: var(--medicine-bg); width: 100%;">
                    <h4 style="color:#555">ğŸŒ¿ è¯å“ç»„éœ€æ±‚</h4>
                    <div class="metric-val" id="res_medicine">0 äºº</div>
                    <div class="metric-sub">ç¼ºå£: <span id="gap_medicine">0.0</span> H</div>
                </div>
            </div>
            <div class="dash-card dash-total">
                <h4 style="color:#922B21">ğŸ† ä»Šæ—¥æ€»éœ€æ±‚</h4>
                <div class="metric-val" style="color:#922B21" id="res_total">0 äºº</div>
                <div class="metric-sub">ç­æ¬¡: <span id="res_shift">8</span> H</div>
            </div>
        </div>

        <div id="view-roche" class="columns view-roche">
            <div class="col">
                <div style="background:var(--roche-blue); color:white; padding:10px; border-radius:6px; margin-bottom:15px; font-weight:bold;">â„ï¸ ç½—æ°å†·é“¾ç»„</div>
                <div class="card"><div class="card-header-cold"><h4>ğŸ“¦ ç½—æ°å†·é“¾ (ä¸»è¥)</h4></div><div class="input-grid">
                    <div class="input-item"><label>æ”¶è´§ç¿»æ‰˜/å…¨æ£€ (æ‰˜)</label><input type="number" class="data-input" data-uph="2.5" id="c_ft"></div>
                    <div class="input-item"><label>æ”¶è´§ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="c_sj"></div>
                    <div class="input-item"><label>å‘è´§æ‹£è´§ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="c_jh"></div>
                    <div class="input-item"><label>æ‰«æåŒ…è£… (ç›’)</label><input type="number" class="data-input" data-uph="110" id="c_bz"></div>
                    <div class="input-item"><label>æ‹†å°è“ç®± (ä¸ª)</label><input type="number" class="data-input" data-uph="13" id="c_lx"></div>
                    <div class="input-item"><label>æ¸©åº¦è®¡ä¸‹è½½ (ä¸ª)</label><input type="number" class="data-input" data-uph="30" id="c_lxx"></div>
                </div></div>
                <div class="card"><div class="card-header-cold"><h4>ğŸ§Š å®‰æ·ä¼¦(å†·é“¾)</h4></div><div class="input-grid">
                    <div class="input-item"><label>æ”¶è´§ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="ag_sj"></div>
                    <div class="input-item"><label>å‘è´§æ‹£è´§ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="ag_jh"></div>
                    <div class="input-item"><label>æ‰«æåŒ…è£… (ç›’)</label><input type="number" class="data-input" data-uph="75" id="ag_bz"></div>
                </div></div>
                <div class="card"><div class="card-header-cold"><h4>ğŸ§Š è±ªæ´›æ·(å†·é“¾)</h4></div><div class="input-grid">
                    <div class="input-item"><label>æ”¶è´§ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="ho_sj"></div>
                    <div class="input-item"><label>å‘è´§æ‹£è´§ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="ho_jh"></div>
                </div></div>
                <div class="card"><div class="card-header-cold"><h4>ğŸ§Š ç½—è¯Šè‡ªè¥</h4></div><div class="input-grid">
                    <div class="input-item"><label>æ”¶è´§ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="se_sj"></div>
                    <div class="input-item"><label>å‘è´§æ‹£è´§ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="se_jh"></div>
                    <div class="input-item"><label>æ‰«æåŒ…è£… (ç›’)</label><input type="number" class="data-input" data-uph="75" id="se_bz"></div>
                </div></div>
                <div class="card"><div class="card-header-cold"><h4>ğŸ” åŠ¨æ€ç›˜ç‚¹</h4></div><div class="input-grid">
                    <div class="input-item"><label>å†·é“¾ç›˜ç‚¹ (æ¡)</label><input type="number" class="data-input" data-uph="20" id="c_pd"></div>
                </div></div>
            </div>
            
            <div class="col">
                <div style="background:var(--roche-sand); color:#5D5046; padding:10px; border-radius:6px; margin-bottom:15px; font-weight:bold;">â˜€ï¸ ç½—æ°å¸¸æ¸©ç»„</div>
                <div class="card"><div class="card-header-amb"><h4>ğŸ§ª ç½—æ°è¯•å‰‚</h4></div><div class="input-grid">
                    <div class="input-item"><label>ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="r_sj"></div>
                    <div class="input-item"><label>å–è´§ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="r_qh"></div>
                    <div class="input-item"><label>æ‰«æåŒ…è£… (ç›’)</label><input type="number" class="data-input" data-uph="120" data-subtype="amb" id="r_bz"></div>
                    <div class="input-item"><label>è½¬å‚¨ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="r_zc"></div>
                </div></div>
                <div class="card"><div class="card-header-amb"><h4>ğŸ”¬ ç½—æ°ä»ªå™¨</h4></div><div class="input-grid">
                    <div class="input-item"><label>å›½å†…åˆ°è´§æ¸…ç‚¹ (ç›’)</label><input type="number" class="data-input" data-uph="80" data-subtype="amb" id="i_qd"></div>
                    <div class="input-item"><label>ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="i_sj"></div>
                    <div class="input-item"><label>å–è´§ (æ¡)</label><input type="number" class="data-input" data-uph="10" data-subtype="amb" id="i_qh"></div>
                    <div class="input-item"><label>æ‰«æåŒ…è£… (PC)</label><input type="number" class="data-input" data-uph="50" data-subtype="amb" id="i_bz"></div>
                    <div class="input-item"><label>è½¬å‚¨ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="i_zc"></div>
                </div></div>
                <div class="card"><div class="card-header-amb"><h4>ğŸ“¦ ç½—è¯Š2æ–¹</h4></div><div class="input-grid">
                    <div class="input-item"><label>åˆ°è´§æ¸…ç‚¹ (PC)</label><input type="number" class="data-input" data-uph="200" data-subtype="amb" id="p2_qd"></div>
                    <div class="input-item"><label>ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="p2_sj"></div>
                    <div class="input-item"><label>ä¸‹æ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="p2_xj"></div>
                    <div class="input-item"><label>åŒ…è£… (PC)</label><input type="number" class="data-input" data-uph="100" data-subtype="amb" id="p2_bz"></div>
                    <div class="input-item"><label>è½¬å‚¨ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="p2_zc"></div>
                </div></div>
                <div class="card"><div class="card-header-amb"><h4>ğŸ¦· å£«å“æ›¼</h4></div><div class="input-grid">
                    <div class="input-item"><label>åˆ°è´§æ¸…ç‚¹ (PC)</label><input type="number" class="data-input" data-uph="200" data-subtype="amb" id="st_qd"></div>
                    <div class="input-item"><label>ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="st_sj"></div>
                    <div class="input-item"><label>ä¸‹æ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="st_xj"></div>
                    <div class="input-item"><label>åŒ…è£… (PC)</label><input type="number" class="data-input" data-uph="200" data-subtype="amb" id="st_bz"></div>
                    <div class="input-item"><label>è½¬å‚¨ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="st_zc"></div>
                </div></div>
                <div class="card"><div class="card-header-amb"><h4>ğŸ˜· é˜²ç–«ç‰©èµ„</h4></div><div class="input-grid">
                    <div class="input-item"><label>åˆ°è´§æ¸…ç‚¹ (PC)</label><input type="number" class="data-input" data-uph="200" data-subtype="amb" id="fy_qd"></div>
                    <div class="input-item"><label>ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="fy_sj"></div>
                    <div class="input-item"><label>ä¸‹æ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="fy_xj"></div>
                    <div class="input-item"><label>åŒ…è£… (PC)</label><input type="number" class="data-input" data-uph="400" data-subtype="amb" id="fy_bz"></div>
                    <div class="input-item"><label>è½¬å‚¨ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="fy_zc"></div>
                </div></div>
                <div class="card"><div class="card-header-amb"><h4>ğŸ¥ è¿ˆç‘</h4></div><div class="input-grid">
                    <div class="input-item"><label>åˆ°è´§æ¸…ç‚¹ (PC)</label><input type="number" class="data-input" data-uph="100" data-subtype="amb" id="mr_qd"></div>
                    <div class="input-item"><label>ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="mr_sj"></div>
                    <div class="input-item"><label>ä¸‹æ¶ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="mr_xj"></div>
                    <div class="input-item"><label>åŒ…è£… (PC)</label><input type="number" class="data-input" data-uph="100" data-subtype="amb" id="mr_bz"></div>
                    <div class="input-item"><label>è½¬å‚¨ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="mr_zc"></div>
                </div></div>
                <div class="card"><div class="card-header-amb"><h4>ğŸ”„ å…¶ä»–</h4></div><div class="input-grid">
                    <div class="input-item"><label>å¸¸æ¸©é€€è´§ (æ¡)</label><input type="number" class="data-input" data-uph="2" data-subtype="amb" id="oth_th"></div>
                    <div class="input-item"><label>å¸¸æ¸©ç›˜ç‚¹ (æ¡)</label><input type="number" class="data-input" data-uph="13" data-subtype="amb" id="oth_pd"></div>
                </div></div>
            </div>
        </div>

        <div id="view-device" class="columns view-device hidden">
            <div class="col">
                <div style="background:var(--device-green); color:white; padding:10px; border-radius:6px; margin-bottom:15px; font-weight:bold;">âš™ï¸ å™¨æ¢°é¡¹ç›®ç»„</div>
                <div class="card"><div class="card-header"><h4>ğŸ”© ä¸“é¡¹æ“ä½œ (SP/å¢¨å°¼å…‹/é”é€‚)</h4></div><div class="input-grid">
                    <div class="input-item"><label>SPåˆ°è´§æ¸…ç‚¹ (PC)</label><input type="number" class="data-input device-input" data-uph="200" id="d_sp_qd"></div>
                    <div class="input-item"><label>å¢¨å°¼å…‹ç¿»æ‰˜ (æ‰˜)</label><input type="number" class="data-input device-input" data-uph="20" id="d_mnk_ft"></div>
                    <div class="input-item"><label>å¢¨å°¼å…‹åŒ…è£… (ç›’)</label><input type="number" class="data-input device-input" data-uph="50" id="d_mnk_bz"></div>
                    <div class="input-item"><label>é”é€‚BOM (ç›’)</label><input type="number" class="data-input device-input" data-uph="50" id="d_rs_bom"></div>
                </div></div>
                <div class="card"><div class="card-header"><h4>ğŸ› ï¸ å™¨æ¢°é€šç”¨æ“ä½œ</h4></div><div class="input-grid">
                    <div class="input-item"><label>æ”¶è´§ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input device-input" data-uph="15" id="d_sj"></div>
                    <div class="input-item"><label>å‘è´§ä¸‹æ¶ (æ¡)</label><input type="number" class="data-input device-input" data-uph="15" id="d_xj"></div>
                    <div class="input-item"><label>æ‰«æåŒ…è£… (ç›’)</label><input type="number" class="data-input device-input" data-uph="50" id="d_bz"></div>
                    <div class="input-item"><label>è´´æ ‡ (ç›’)</label><input type="number" class="data-input device-input" data-uph="100" id="d_tb"></div>
                </div></div>
            </div>
        </div>

        <div id="view-medicine" class="columns view-medicine hidden">
            <div class="col">
                <div style="background:var(--medicine-purple); color:white; padding:10px; border-radius:6px; margin-bottom:15px; font-weight:bold;">ğŸŒ¿ è¯å“é¡¹ç›®ç»„</div>
                <div class="card"><div class="card-header"><h4>ğŸ’Š è¯å“åŸºç¡€ä½œä¸š</h4></div><div class="input-grid">
                    <div class="input-item"><label>æ”¶è´§ä¸Šæ¶ (æ¡)</label><input type="number" class="data-input medicine-input" data-uph="20" id="p_sj"></div>
                    <div class="input-item"><label>å‘è´§ä¸‹æ¶ (æ¡)</label><input type="number" class="data-input medicine-input" data-uph="20" id="p_xj"></div>
                    <div class="input-item"><label>æ‰«æåŒ…è£… (æ¡)</label><input type="number" class="data-input medicine-input" data-uph="100" id="p_bz"></div>
                    <div class="input-item"><label>è´´æ ‡ (ç›’)</label><input type="number" class="data-input medicine-input" data-uph="150" id="p_tb"></div>
                </div></div>
                <div class="card"><div class="card-header"><h4>ğŸ—ï¸ è¯å“ä¸“é¡¹ä½œä¸š</h4></div><div class="input-grid">
                    <div class="input-item"><label>ç½—è´¸&ç½—è¯ç¿»æ‰˜ (æ‰˜)</label><input type="number" class="data-input medicine-input" data-uph="20" id="p_ft"></div>
                    <div class="input-item"><label>è±ªæ´›æ·æ”¶è´§ (æ‰˜)</label><input type="number" class="data-input medicine-input" data-uph="20" id="p_hlj_sh"></div>
                    <div class="input-item"><label>è±ªæ´›æ·æ‰“æ ‡ç­¾ (ä¸ª)</label><input type="number" class="data-input medicine-input" data-uph="100" id="p_hlj_tb"></div>
                    <div class="input-item"><label>ç”µå•†åˆ†åŒ… (å¥—)</label><input type="number" class="data-input medicine-input" data-uph="50" id="p_ds"></div>
                </div></div>
            </div>
        </div>

        <div class="chart-container">
            <h3 style="margin-bottom:20px;">ğŸ“Š å„ç¯èŠ‚äººåŠ›åˆ†å¸ƒæ¨è</h3>
            <div id="chart-area">
                <div style="text-align:center; color:#999; padding:20px;">æš‚æ— è¾“å…¥æ•°æ®</div>
            </div>
        </div>
    </div>

    <div id="pdf-container"></div>

<script>
    const date = new Date();
    const dateStr = date.getFullYear() + "å¹´" + (date.getMonth() + 1) + "æœˆ" + date.getDate() + "æ—¥";
    document.getElementById('currentDate').innerText = dateStr;

    let currentProject = 'roche';

    function calcStaff() {
        const groups = ['roche_cold', 'roche_amb', 'device', 'medicine'];
        groups.forEach(g => {
            const base = parseInt(document.getElementById('base_' + g)?.value) || 0;
            const abs = parseInt(document.getElementById('abs_' + g)?.value) || 0;
            const sup = parseInt(document.getElementById('sup_' + g)?.value) || 0;
            const actual = Math.max(0, base - abs + sup);
            const targetInput = document.getElementById('fc_' + g);
            if(targetInput) targetInput.value = actual;
        });
    }

    function switchView() {
        const select = document.getElementById('project-select');
        currentProject = select.value;
        const pageTitle = document.getElementById('page-title');

        document.getElementById('view-roche').classList.add('hidden');
        document.getElementById('view-device').classList.add('hidden');
        document.getElementById('view-medicine').classList.add('hidden');
        
        document.getElementById('formal-roche').classList.add('hidden');
        document.getElementById('formal-device').classList.add('hidden');
        document.getElementById('formal-medicine').classList.add('hidden');

        document.getElementById('dash-roche-group').classList.add('hidden');
        document.getElementById('dash-device-group').classList.add('hidden');
        document.getElementById('dash-medicine-group').classList.add('hidden');

        if (currentProject === 'roche') {
            document.getElementById('view-roche').classList.remove('hidden');
            document.getElementById('formal-roche').classList.remove('hidden');
            document.getElementById('dash-roche-group').classList.remove('hidden');
            document.getElementById('dash-roche-group').style.display = 'flex'; 
            pageTitle.innerText = "ç½—è¯Šé¡¹ç›®äººåŠ›æ’ç­å†³ç­–æ¨¡å‹";
            select.style.backgroundColor = "var(--roche-blue)";
        } else if (currentProject === 'device') {
            document.getElementById('view-device').classList.remove('hidden');
            document.getElementById('formal-device').classList.remove('hidden');
            document.getElementById('dash-device-group').classList.remove('hidden');
            document.getElementById('dash-device-group').style.display = 'flex';
            pageTitle.innerText = "å™¨æ¢°é¡¹ç›®äººåŠ›æ’ç­å†³ç­–æ¨¡å‹";
            select.style.backgroundColor = "var(--device-green)";
        } else if (currentProject === 'medicine') {
            document.getElementById('view-medicine').classList.remove('hidden');
            document.getElementById('formal-medicine').classList.remove('hidden');
            document.getElementById('dash-medicine-group').classList.remove('hidden');
            document.getElementById('dash-medicine-group').style.display = 'flex';
            pageTitle.innerText = "è¯å“é¡¹ç›®äººåŠ›æ’ç­å†³ç­–æ¨¡å‹";
            select.style.backgroundColor = "var(--medicine-purple)";
        }
        update(); 
    }

function init() {
        // è·å–ç½‘å€é‡Œçš„å‚æ•°
        const params = new URLSearchParams(window.location.search);

        document.querySelectorAll('input, select').forEach(el => {
            // 1. å…ˆå°è¯•ä» LocalStorage è¯»å– (ä»…é™ base_ å¼€å¤´çš„æ­£å¼å·¥åœ¨å†Œäººæ•°)
            if (el.id && el.id.startsWith('base_')) {
                const stored = localStorage.getItem(el.id);
                if (stored) el.value = stored;
            }

            // 2. â˜…â˜…â˜… ä¿®å¤æ ¸å¿ƒï¼šå¦‚æœç½‘å€é‡Œå¸¦äº†æ•°æ®ï¼Œå¼ºåˆ¶è¦†ç›–å¡«å…¥æ¡†å†… â˜…â˜…â˜…
            if (el.id && params.has(el.id)) {
                el.value = params.get(el.id);
            }
        });
        
        // 3. ç¡®ä¿åˆ‡æ¢åˆ°æ­£ç¡®çš„é¡¹ç›®è§†å›¾
        if(params.has('project-select')){
            document.getElementById('project-select').value = params.get('project-select');
        }
        
        switchView(); 
    }

    function update() {
        calcStaff();
        document.querySelectorAll('.staff-base').forEach(el => { localStorage.setItem(el.id, el.value); });

        const eff = parseFloat(document.getElementById('eff').value);
        const oee = parseFloat(document.getElementById('oee').value);
        const shift = parseInt(document.getElementById('shift').value);

        document.getElementById('disp_eff').innerText = eff.toFixed(2);
        document.getElementById('disp_oee').innerText = oee.toFixed(2);
        document.getElementById('res_shift').innerText = shift;

        let totalNeed = 0;
        let chartData = [];
        const tempCapPerPerson = shift * oee * eff;

        if (currentProject === 'roche') {
            const fcCold = parseInt(document.getElementById('fc_roche_cold').value) || 0;
            const fcAmb = parseInt(document.getElementById('fc_roche_amb').value) || 0;
            let hoursCold = 0, hoursAmb = 0;

            document.querySelectorAll('#view-roche .data-input').forEach(input => {
                const val = parseInt(input.value) || 0;
                if(val > 0) {
                    const uph = parseFloat(input.dataset.uph);
                    const hours = val / uph;
                    const isAmb = input.dataset.subtype === 'amb';
                    const label = input.previousElementSibling.innerText;
                    const groupTitle = input.closest('.card').querySelector('h4').innerText.split(' ')[1] || "";
                    const fullName = groupTitle ? `${groupTitle}-${label}` : label;

                    if(isAmb) hoursAmb += hours; else hoursCold += hours;
                    chartData.push({ name: fullName, hours: hours, people: hours / tempCapPerPerson, color: isAmb ? 'var(--roche-sand)' : 'var(--roche-blue)' });
                }
            });

            const gapCold = Math.max(0, (hoursCold / oee) - (fcCold * shift));
            const gapAmb = Math.max(0, (hoursAmb / oee) - (fcAmb * shift));
            const needCold = Math.ceil(gapCold / tempCapPerPerson);
            const needAmb = Math.ceil(gapAmb / tempCapPerPerson);

            document.getElementById('res_roche_cold').innerText = needCold + " äºº";
            document.getElementById('gap_roche_cold').innerText = gapCold.toFixed(1);
            document.getElementById('res_roche_amb').innerText = needAmb + " äºº";
            document.getElementById('gap_roche_amb').innerText = gapAmb.toFixed(1);
            totalNeed = needCold + needAmb;

        } else if (currentProject === 'device') {
            const fc = parseInt(document.getElementById('fc_device').value) || 0;
            let totalHours = 0;
            document.querySelectorAll('#view-device .data-input').forEach(input => {
                const val = parseInt(input.value) || 0;
                if(val > 0) {
                    const uph = parseFloat(input.dataset.uph);
                    const hours = val / uph;
                    const label = input.previousElementSibling.innerText;
                    const groupTitle = input.closest('.card').querySelector('h4').innerText.split(' ')[1] || "";
                    const fullName = `${groupTitle}-${label}`;
                    totalHours += hours;
                    chartData.push({ name: fullName, hours: hours, people: hours / tempCapPerPerson, color: 'var(--device-green)' });
                }
            });
            const gap = Math.max(0, (totalHours / oee) - (fc * shift));
            const need = Math.ceil(gap / tempCapPerPerson);
            document.getElementById('res_device').innerText = need + " äºº";
            document.getElementById('gap_device').innerText = gap.toFixed(1);
            totalNeed = need;

        } else if (currentProject === 'medicine') {
            const fc = parseInt(document.getElementById('fc_medicine').value) || 0;
            let totalHours = 0;
            document.querySelectorAll('#view-medicine .data-input').forEach(input => {
                const val = parseInt(input.value) || 0;
                if(val > 0) {
                    const uph = parseFloat(input.dataset.uph);
                    const hours = val / uph;
                    const label = input.previousElementSibling.innerText;
                    const groupTitle = input.closest('.card').querySelector('h4').innerText.split(' ')[1] || "";
                    const fullName = `${groupTitle}-${label}`;
                    totalHours += hours;
                    chartData.push({ name: fullName, hours: hours, people: hours / tempCapPerPerson, color: 'var(--medicine-purple)' });
                }
            });
            const gap = Math.max(0, (totalHours / oee) - (fc * shift));
            const need = Math.ceil(gap / tempCapPerPerson);
            document.getElementById('res_medicine').innerText = need + " äºº";
            document.getElementById('gap_medicine').innerText = gap.toFixed(1);
            totalNeed = need;
        }

        document.getElementById('res_total').innerText = totalNeed + " äºº";
        renderChart(chartData);
    }

    function renderChart(data) {
        const container = document.getElementById('chart-area');
        container.innerHTML = "";
        if (data.length === 0) {
            container.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">æš‚æ— è¾“å…¥æ•°æ®</div>';
            return;
        }
        data.sort((a, b) => b.hours - a.hours);
        const maxHours = data[0].hours;
        data.forEach(item => {
            const widthPct = (item.hours / maxHours) * 100;
            const peopleNum = item.people < 0.1 ? "<0.1" : item.people.toFixed(1);
            const row = document.createElement('div');
            row.className = 'chart-row';
            row.innerHTML = `<div class="chart-label" title="${item.name}">${item.name}</div>
                <div class="chart-bar-area"><div class="chart-bar" style="width: ${widthPct}%; background-color: ${item.color}">${item.hours.toFixed(1)} H</div></div>
                <div class="chart-val">æ¨è: ${peopleNum}äºº</div>`;
            container.appendChild(row);
        });
    }

    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const pdfContainer = document.getElementById('pdf-container');
        document.getElementById('pdf-msg').style.display = 'block';

        const colorMap = {
            'roche': ['#2C3E50', '#c0392b', '#2980b9'], // æ ‡é¢˜è‰², ç¼ºå£çº¢, å¼ºè°ƒè“
            'device': ['#556B2F', '#c0392b', '#9CAF88'],
            'medicine': ['#555', '#c0392b', '#95A5A6']
        };
        const theme = colorMap[currentProject];

        let html = `
            <div class="pdf-header">
                <div class="pdf-title" style="color:${theme[0]}">${document.getElementById('page-title').innerText} - æ—¥æŠ¥</div>
                <div class="pdf-date">${dateStr}</div>
            </div>
        `;

        html += `<div class="pdf-decision-row">`;
        if (currentProject === 'roche') {
            html += `<div class="pdf-kpi-card" style="background:var(--roche-blue)"><div class="pdf-kpi-title">â„ï¸ å†·é“¾éœ€æ±‚</div><div class="pdf-kpi-val">${document.getElementById('res_roche_cold').innerText}</div><div class="pdf-kpi-sub">ç¼ºå£å·¥æ—¶: ${document.getElementById('gap_roche_cold').innerText} H</div></div>`;
            html += `<div class="pdf-kpi-card" style="background:var(--roche-sand)"><div class="pdf-kpi-title">â˜€ï¸ å¸¸æ¸©éœ€æ±‚</div><div class="pdf-kpi-val">${document.getElementById('res_roche_amb').innerText}</div><div class="pdf-kpi-sub">ç¼ºå£å·¥æ—¶: ${document.getElementById('gap_roche_amb').innerText} H</div></div>`;
        } else if (currentProject === 'device') {
            html += `<div class="pdf-kpi-card" style="background:var(--device-green)"><div class="pdf-kpi-title">âš™ï¸ å™¨æ¢°éœ€æ±‚</div><div class="pdf-kpi-val">${document.getElementById('res_device').innerText}</div><div class="pdf-kpi-sub">ç¼ºå£å·¥æ—¶: ${document.getElementById('gap_device').innerText} H</div></div>`;
        } else {
            html += `<div class="pdf-kpi-card" style="background:var(--medicine-purple)"><div class="pdf-kpi-title">ğŸŒ¿ è¯å“éœ€æ±‚</div><div class="pdf-kpi-val">${document.getElementById('res_medicine').innerText}</div><div class="pdf-kpi-sub">ç¼ºå£å·¥æ—¶: ${document.getElementById('gap_medicine').innerText} H</div></div>`;
        }
        html += `<div class="pdf-kpi-card" style="background:#e74c3c"><div class="pdf-kpi-title">ğŸ† ä»Šæ—¥æ€»éœ€æ±‚</div><div class="pdf-kpi-val">${document.getElementById('res_total').innerText}</div><div class="pdf-kpi-sub">ç­æ¬¡æ—¶é•¿: ${document.getElementById('shift').value} H</div></div>`;
        html += `</div>`;

        let staffInfo = "";
        if(currentProject === 'roche') {
            staffInfo = `â„ï¸å†·é“¾(åœ¨${document.getElementById('base_roche_cold').value}/å®${document.getElementById('fc_roche_cold').value})  â˜€ï¸å¸¸æ¸©(åœ¨${document.getElementById('base_roche_amb').value}/å®${document.getElementById('fc_roche_amb').value})`;
        } else if (currentProject === 'device') {
            staffInfo = `âš™ï¸å™¨æ¢°(åœ¨${document.getElementById('base_device').value}/å®${document.getElementById('fc_device').value})`;
        } else {
            staffInfo = `ğŸŒ¿è¯å“(åœ¨${document.getElementById('base_medicine').value}/å®${document.getElementById('fc_medicine').value})`;
        }

        html += `
            <div class="pdf-resource-bar">
                <div class="pdf-res-item">åŸºç¡€å‚æ•°: <strong>Eff ${document.getElementById('eff').value} / OEE ${document.getElementById('oee').value}</strong></div>
                <div class="pdf-res-item">æ­£å¼å·¥ç°çŠ¶: <strong>${staffInfo}</strong></div>
            </div>
        `;

        html += `<div class="pdf-details-grid">`;
        const activeView = document.getElementById('view-' + currentProject);
        const cols = activeView.querySelectorAll('.col'); 
        
        cols.forEach(col => {
            html += `<div class="pdf-grid-col">`;
            const sectionTitle = col.querySelector('div[style*="font-weight:bold"]').innerText;
            html += `<div class="pdf-col-title">${sectionTitle}</div>`;
            
            col.querySelectorAll('.card').forEach(card => {
                const groupName = card.querySelector('h4').innerText;
                let groupHtml = `<div class="pdf-task-group"><div class="pdf-group-name">${groupName}</div>`;
                let hasItem = false;
                
                card.querySelectorAll('.data-input').forEach(input => {
                    if(parseInt(input.value) > 0) {
                        hasItem = true;
                        const taskName = input.previousElementSibling.innerText;
                        groupHtml += `<div class="pdf-task-item"><span class="pdf-task-name">${taskName}</span><span>${input.value}</span></div>`;
                    }
                });
                groupHtml += `</div>`;
                if(hasItem) html += groupHtml;
            });
            html += `</div>`;
        });
        html += `</div>`;

        html += `<div class="pdf-chart-section"><div class="pdf-chart-title">ğŸ“ˆ äººåŠ›åˆ†å¸ƒæ¨è (äºº)</div>`;
        html += document.getElementById('chart-area').innerHTML;
        html += `</div>`;

        pdfContainer.innerHTML = html;

        try {
            const canvas = await html2canvas(pdfContainer, { scale: 2 });
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const imgWidth = 210;
            const imgHeight = canvas.height * imgWidth / canvas.width;
            pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
            pdf.save(`${currentProject}_äººåŠ›æ—¥æŠ¥_${dateStr}.pdf`);
        } catch (e) {
            alert("PDF ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ (éœ€åŠ è½½ç”Ÿæˆåº“)");
        } finally {
            document.getElementById('pdf-msg').style.display = 'none';
            pdfContainer.innerHTML = ''; 
        }
    }

    function generateLink() {
        const params = new URLSearchParams();
        document.querySelectorAll('input, select').forEach(el => {
            if (el.value != 0 && el.id) params.set(el.id, el.value);
        });
        const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + "?" + params.toString();
        navigator.clipboard.writeText(newUrl).then(() => {
            document.getElementById('link-msg').style.display = 'block';
            setTimeout(() => { document.getElementById('link-msg').style.display = 'none'; }, 3000);
        });
    }

    document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('input', update);
    });

    window.onload = init;
</script>

</body>

</html>


